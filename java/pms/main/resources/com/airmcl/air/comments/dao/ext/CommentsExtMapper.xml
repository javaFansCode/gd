<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.airmcl.air.comments.dao.ext.CommentsExtMapper" >

  <select id="selectCommentsByParams" resultType="com.airmcl.air.comments.entity.CommentsExt" parameterType="com.airmcl.air.comments.entity.CommentsExt" >

    select a.id AS id,a.nickname AS nickname,a.service_name AS serviceName,b.beauty_name AS beauty_name,
      c.name AS name,a.is_reply AS is_reply,a.content AS content,a.state AS state from
      ((mdd_api_comments a left join mdd_api_beauty b on((a.beauty_id = b.id)))
      left join mdd_api_beautician c on((a.bt_id = c.id))) where 1 = 1
    <if test="id != null">
      AND a.id = #{id}
    </if>
    <if test="nickname !=null">
      AND a.nickname LIKE '%${nickname}%'
    </if>
    <if test="serviceName !=null">
      AND a.service_name LIKE '%${serviceName}%'
    </if>
    <if test="name !=null">
      AND c.name LIKE '%${name}%'
    </if>
    <if test="content !=null">
      AND a.content LIKE '%${content}%'
    </if>
    <if test="commentstate != null">AND a.state IN
      <foreach collection="commentstate" index="index" item="item" open="(" separator="," close=")">
        #{item}
      </foreach>
    </if>
    <if test="startcreatetime != null &amp; endcreatetime != null ">AND a.createtime between #{startcreatetime} AND #{endcreatetime}
    </if>
      limit #{pageNo},#{pageSize}
  </select>


  <select id="countCommentByParams" parameterType="com.airmcl.air.comments.entity.CommentsExt" resultType="java.lang.Integer" >
    select count(1) from
    ((mdd_api_comments a left join mdd_api_beauty b on((a.beauty_id = b.id)))
    left join mdd_api_beautician c on((a.bt_id = c.id))) where 1 = 1
    <if test="id != null">
      AND a.id = #{id}
    </if>
    <if test="nickname !=null">
      AND a.nickname LIKE '%${nickname}%'
    </if>
    <if test="serviceName !=null">
      AND a.service_name LIKE '%${serviceName}%'
    </if>
    <if test="name !=null">
      AND c.name LIKE '%${name}%'
    </if>
    <if test="content !=null">
      AND a.content LIKE '%${content}%'
    </if>
    <if test="commentstate != null">AND a.state IN
      <foreach collection="commentstate" index="index" item="item" open="(" separator="," close=")">
        #{item}
      </foreach>
    </if>
    <if test="startcreatetime != null &amp; endcreatetime != null ">AND a.createtime between #{startcreatetime} AND #{endcreatetime}
    </if>
  </select>

</mapper>